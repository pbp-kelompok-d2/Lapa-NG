{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Dashboard - LapaNG</title>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}

<style>
/* Hide scrollbar for panels while keeping them scrollable */
#bookings-panel::-webkit-scrollbar,
#courts-panel::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;
}
#bookings-panel,
#courts-panel {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

/* Toggle buttons */
.panel-toggle { display: inline-flex; gap: 8px; align-items: center; }
.panel-toggle button {
  padding: 6px 12px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(255,255,255,0.12);
  color: #0f172a;
  font-weight: 600;
  cursor: pointer;
  transition: all .18s ease;
}
.panel-toggle button[data-active="true"] {
  background: rgba(255,255,255,0.92);
  color: #065f46;
  box-shadow: 0 4px 14px rgba(2,6,23,0.06);
  border-color: rgba(255,255,255,0.95);
}

/* panel sizing */
.panel-body {
  height: calc(50vh - 6rem);
}

#bookings-list,
#courts-list {
  padding: 0 0.75rem 0.75rem 0.75rem; /* adds spacing from edges */
}

#bookings-list > div,
#courts-list > div {
  margin-left: 0.25rem;
  margin-right: 0.25rem;
}
</style>

<div class="min-h-1/2 bg-gray-50 pt-24 px-6 pb-6">
  <div class="max-w-7xl mx-auto">
    <div class="flex flex-col lg:flex-row lg:items-start gap-6">

      <!-- LEFT CARD -->
      <aside id="left-card" class="w-full lg:w-3/12 flex-none">
        <div class="lg:sticky lg:top-24">
          <div class="bg-gradient-to-br from-[#3b82f680] to-[#10b98180] rounded-2xl shadow-lg p-6 text-center flex flex-col items-center justify-start">
            {% if profile and profile.profile_picture %}
            <img src="{{ profile.profile_picture }}" alt="{{ user.username }}" class="w-36 h-36 rounded-full object-cover border-2 border-white shadow-sm mb-4 profile-avatar" />
            {% else %}
            <img src="{% static 'images/user.png' %}" alt="avatar" class="w-36 h-36 rounded-full object-cover border-2 border-white shadow-sm mb-4 profile-avatar" />
            {% endif %}

            <h2 class="text-2xl font-extrabold text-gray-900 profile-fullname">{{ user.customuser.name }}</h2>
            {% if profile.number %}
            <p id="profile-number" class="text-gray-500 text-sm mt-1" data-raw="{{ profile.number }}">{{ profile.formatted_number }}</p>
            {% endif %}
            <p class="text-sm text-green-600 mt-1 profile-role">{{ profile.role|capfirst }}</p>

            <div class="mt-6 grid grid-cols-3 gap-3 text-center w-full max-w-xs">
              <div><div class="text-xs text-gray-500">Bookings</div><div class="font-semibold text-gray-800">{{ counts.bookings|default:0 }}</div></div>
              <div><div class="text-xs text-gray-500">Equipment</div><div class="font-semibold text-gray-800">{{ counts.equipment|default:0 }}</div></div>
              <div><div class="text-xs text-gray-500">Reviews</div><div class="font-semibold text-gray-800">{{ counts.reviews|default:0 }}</div></div>
            </div>

            <div class="mt-auto w-full flex justify-center gap-3 pt-6 pb-2">
              <button id="edit-profile-btn"
                      data-username="{{ user.username|default:'' }}"
                      data-name="{{ profile.name|default:user.get_full_name|default:'' }}"
                      data-number="{{ profile.number|default:'' }}"
                      data-profile_picture="{{ profile.profile_picture|default:'' }}"
                      data-edit-url="{% url 'authentication:edit_profile' %}"
                      class="flex items-center gap-2 px-4 py-2 rounded text-sm border border-white/60 bg-white/20 backdrop-blur-sm text-gray-800 shadow-sm hover:bg-white/25 hover:shadow-md transition">
                <svg class="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 11l6-6 3 3-6 6H9v-3z"/></svg>
                <span>Edit</span>
              </button>

              <button id="delete-profile-btn"
                      data-delete-url="{% url 'authentication:delete_profile' %}"
                      class="flex items-center gap-2 px-4 py-2 rounded text-sm border border-red-500 bg-red-500/20 backdrop-blur-sm text-red-600 shadow-sm hover:bg-red-500/40 hover:shadow-md transition">
                <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                <span>Delete</span>
              </button>
            </div>
          </div>
        </div>
      </aside>

      <!-- RIGHT CARD -->
      <main id="right-card" class="w-full lg:flex-1">
        <div class="bg-gradient-to-br from-[#3b82f680] to-[#10b98180] rounded-2xl shadow-lg h-[50vh] flex flex-col overflow-hidden">
          <div class="px-6 py-5 flex justify-between items-center flex-none">
            <h2 id="dashboard-title" class="text-2xl font-extrabold text-green-600">Booked Courts</h2>
            <div class="flex gap-2">
              <button id="tab-bookings" class="px-4 py-1 rounded-full bg-white text-green-600 font-semibold text-sm shadow-sm">Booked Courts</button>
              {% if user.customuser.role == "owner" %}
              <button id="tab-courts" class="px-4 py-1 rounded-full bg-white/30 text-gray-700 font-semibold text-sm shadow-sm hover:bg-white/40">My Courts</button>
              {% endif %}
            </div>
          </div>

          <div class="relative flex-1 overflow-hidden px-6 pb-6">
            <div id="bookings-panel" data-limit="{{ bookings_limit|default:12 }}" data-default-image="{% static 'images/No_Image_Available.jpg' %}" class="absolute inset-0 overflow-y-auto pr-2 space-y-4 transition-all duration-300">
              <div id="bookings-list" class="space-y-4"></div>
              <div id="bookings-loading" class="text-center py-4 hidden">Loading...</div>
            </div>

            {% if user.customuser.role == "owner" %}
            <div id="courts-panel" data-limit="{{ bookings_limit|default:12 }}" data-default-image="{% static 'images/No_Image_Available.jpg' %}" class="absolute inset-0 overflow-y-auto pr-2 space-y-4 hidden transition-all duration-300">
              <div id="courts-list" class="space-y-4"></div>
              <div id="courts-loading" class="text-center py-4 hidden">Loading...</div>
            </div>
            {% endif %}
          </div>
        </div>
      </main>
    </div>
  </div>
</div>

<!-- Toast container -->
<div id="global-toast" class="fixed bottom-6 right-6 z-60 hidden">
  <div id="global-toast-inner" class="max-w-sm w-full rounded-lg shadow-lg p-3 flex items-center gap-3 bg-green-600 text-white transform transition-all duration-500 opacity-0 translate-y-4">
    <div id="global-toast-message" class="text-sm font-medium">Profile Updated!</div>
  </div>
</div>

{% endblock content %}

{% block scripts %}
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock scripts %}
